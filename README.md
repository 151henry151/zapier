# BTCPay Server Integration for Zapier.com

This repository contains the Zapier integration for BTCPay Server.
The Zapier integration allows you to use triggers from BTCPay Server (like when a new invoice was created, paid or expired) to trigger actions in other systems, like send an email, post a chat message, etc.

## Requirements
- An account at Zapier.com
- A BTCPay Server instance where you have 1 or more stores
- An API key that has access to the store and resources you want to automate (BEWARE: Never grant more permissions that is absolutely needed!)

## Security Considerations
With great power comes great responsibility. So when you automate your BTCPay Server, you should consider the things that could go wrong or get abused if someone were to get hold of your API Key.
Because you will be providing Zapier with your API key, we strongly encourage you to create an API key with as little permissions as possible.
If you are only going to automate a single store, make sure the API key only has access to the resources for that specific store.
BTCPay Server allows your to configure access per store, so use it.

## How does it work technically?
- Every trigger registers its own webhook in the store it is for. There are no global webhooks in BTCPay Server, only ones per store.
- The webhook only handles the single event it is created for.
- When you enable the Zap, the webhook is automatically created in BTCPay Server and when you disable, the webhook is deleted.
- Each webhook uses its own secret, randomly generated by BTCPay Server. 
- The webhook's request signature `BTCPay-Sig` is used to verify the identity of the sender.

## Current state
This integration uses the new Greenfield API and webhooks for real-time communications.
All triggers and actions in this repo should be functional.
More triggers and actions will be added over time.

Working Triggers (incl tests):
- CreateInvoice Created

Working Triggers (without tests):
- CreateInvoice Expired
- CreateInvoice Invalid
- CreateInvoice Processing
- CreateInvoice Settled
- Payment Received

Working Actions:
- Create a New Invoice
- Mark Invoice as Invalid
- Mark Invoice as Settled (test needed)

Working Searches:
- Find an Invoice by Order ID

## Tests
Tests are implemented with Jest and should work 100%. Just run `zapier test` to run them.

## Troubleshooting

### I deleted the webhook from my BTCPay Server store by mistake.
No worries. Just turn your Zap off and on again and the webhook will automatically be recreated in BTCPay Server.

## Need or prefer professional help?
This integration was developed by [Storefront.be](https://www.storefront.be). You can reach out to us for paid support and consultancy. 